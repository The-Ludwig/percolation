var b=Object.defineProperty;var m=(g,i,e)=>i in g?b(g,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[i]=e;var o=(g,i,e)=>(m(g,typeof i!="symbol"?i+"":i,e),e);import{s as _,z as v,i as w,t as L}from"./vendor.f720daf1.js";const M=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&h(l)}).observe(document,{childList:!0,subtree:!0});function e(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(t){if(t.ep)return;t.ep=!0;const s=e(t);fetch(t.href,s)}};M();class E{constructor(i,e,h){o(this,"anim_ms");o(this,"anim_wait");o(this,"svg_id");o(this,"svg");o(this,"view");o(this,"zoom");o(this,"width");o(this,"height");o(this,"button",_("#percButton").node());o(this,"p_slider",_("#pSlider").node());o(this,"x_slider",_("#xSlider").node());o(this,"y_slider",_("#ySlider").node());o(this,"lattice_select",_("#lattice-select").node());o(this,"p",Number(this.p_slider.value));o(this,"nx",Number(this.x_slider.value));o(this,"ny",Number(this.y_slider.value));o(this,"r",0);o(this,"changed",!0);o(this,"grid_points",[]);o(this,"grid_lines",[]);o(this,"clusters",[]);o(this,"lattice");this.anim_ms=e,this.anim_wait=h,this.svg_id=i,this.svg=_(i),this.width=this.svg.node().clientWidth,this.height=this.svg.node().clientHeight,this.svg.attr("viewBox",String([0,0,this.width,this.height])).attr("width",this.width).attr("height",this.height),this.view=this.svg.append("g"),this.zoom=v().touchable(()=>!0).scaleExtent([.25,16]).on("zoom",t=>{const{transform:s}=t;this.view.attr("transform",s)}),this.svg.node().addEventListener("click",()=>{this.svg.transition().duration(750).call(this.zoom.transform,w,L(this.svg.node()).invert([this.width/2,this.height/2]))}),this.p_slider.previousElementSibling.innerHTML=`p=${this.p.toFixed(2)}`,this.x_slider.previousElementSibling.innerHTML=`N_x=${this.nx.toFixed(0)}`,this.y_slider.previousElementSibling.innerHTML=`N_y=${this.ny.toFixed(0)}`,this.lattice=this.lattice_select.value,this.p_slider.addEventListener("input",()=>{this.p=Number(this.p_slider.value),this.p_slider.previousElementSibling.innerHTML=`p=${this.p.toFixed(2)}`}),this.x_slider.addEventListener("input",()=>{let t=Number(this.x_slider.value);this.x_slider.previousElementSibling.innerHTML=`N_x=${t.toFixed(0)}`}),this.y_slider.addEventListener("input",()=>{let t=Number(this.y_slider.value);this.y_slider.previousElementSibling.innerHTML=`N_y=${t.toFixed(0)}`}),this.lattice_select.addEventListener("change",t=>{this.lattice=this.lattice_select.value,this.changed=!0}),this.p_slider.addEventListener("change",t=>{}),this.x_slider.addEventListener("change",()=>{this.changed=!0}),this.y_slider.addEventListener("change",()=>{this.changed=!0}),this.button.addEventListener("click",()=>{this.changed?(this.init(),this.changed=!1):(this.calc_occupation(),this.calc_lines(),this.draw())}),this.init()}recalc_r(i=1,e=1){this.r=Math.min(this.width*i/this.nx,this.height*e/this.ny)/3}calc_occupation(){for(let i of this.grid_points)i.occupied=Math.random()<this.p}calc_points(){switch(this.lattice){case"triangular":this.triangular_lattice();break;case"square":this.square_lattice();break;case"ugly_square":this.non_square_lattice();break;case"honeycomb":this.honeycomb_lattice();break;default:this.triangular_lattice()}}non_square_lattice(){this.recalc_r();let i=this.r+5,e=this.r+5,h=(this.width-2*i)/(this.nx-1),t=(this.height-2*e)/(this.ny-1);delete this.grid_points,this.grid_points=[];for(let s=0;s<this.nx;s++)for(let l=0;l<this.ny;l++){let n=new f(i+h*s,e+t*l,Math.random()<this.p);if(s!=0){let r=this.grid_points[(s-1)*this.ny+l];r.neighbours.push(n),n.neighbours.push(r)}if(l!=0){let r=this.grid_points[s*this.ny+(l-1)];r.neighbours.push(n),n.neighbours.push(r)}this.grid_points.push(n)}}triangular_lattice(){this.recalc_r();let i,e,h,t,s=Math.sqrt(3)/2;this.nx*s>=this.ny?(i=this.r+5,h=(this.width-2*i)/(this.nx-1),t=h/s,e=i+(this.height-t*this.ny)/2):(e=this.r+5,t=(this.height-2*e)/(this.ny-1),h=t*s,i=e+(this.width-h*this.nx)/2),delete this.grid_points,this.grid_points=[];let l=(n,r)=>n*this.ny+r-Math.floor(n/2);for(let n=0;n<this.nx;n++){let r=n%2;for(let a=0;a<this.ny-r;a++){let c=new f(i+h*n,e+t*a+r*t/2,Math.random()<this.p);if(n!=0&&a!=this.ny-1){let d=this.grid_points[l(n-1,a)];d.neighbours.push(c),c.neighbours.push(d)}if(n!=0&&a+2*r!=0){let d=this.grid_points[l(n-1,a+2*r-1)];d.neighbours.push(c),c.neighbours.push(d)}if(a!=0){let d=this.grid_points[l(n,a-1)];d.neighbours.push(c),c.neighbours.push(d)}this.grid_points.push(c)}}}square_lattice(){this.recalc_r();let i,e,h,t;this.nx>=this.ny?(i=this.r+5,h=(this.width-2*i)/(this.nx-1),t=h,e=i+(this.height-this.width/this.nx*this.ny)/2):(e=this.r+5,t=(this.height-2*e)/(this.ny-1),h=t,i=(this.width-this.height/this.ny*this.nx)/2),delete this.grid_points,this.grid_points=[];for(let s=0;s<this.nx;s++)for(let l=0;l<this.ny;l++){let n=new f(i+h*s,e+t*l,Math.random()<this.p);if(s!=0){let r=this.grid_points[(s-1)*this.ny+l];r.neighbours.push(n),n.neighbours.push(r)}if(l!=0){let r=this.grid_points[s*this.ny+(l-1)];r.neighbours.push(n),n.neighbours.push(r)}this.grid_points.push(n)}}honeycomb_lattice(){this.recalc_r(1,.5);let i,e,h,t,s=Math.sqrt(3);function l(r){let a;switch((r-1)%4){case 0:a=0;break;case 1:a=.5;break;case 2:a=1.5;break;case 3:a=2;break}return a}if(this.nx*3/4>=this.ny){let r=l(this.nx);i=this.r+5,h=(this.width-2*i)/(3*Math.floor((this.nx-1)/4)+r),t=h*s,e=i+t+(this.height-t*this.ny)/2}else e=this.r+5,t=(this.height-2*e)/(this.ny-1),e=e+t/2,h=t/s,i=e+(this.width-h*3/4*this.nx)/2;delete this.grid_points,this.grid_points=[];let n=(r,a)=>r*this.ny+a-(Math.ceil(r/4)+Math.floor(r/4));for(let r=0;r<this.nx;r++){let a=r%4,c=a==1||a==2?1:0;for(let d=0;d<this.ny-1+c;d++){let u=new f(i+h*(r-Math.floor((r+1)/2)/2),e+t*d-c*t/2,Math.random()<this.p);switch(a){case 0:if(r!=0){let p=this.grid_points[n(r-1,d)];p.neighbours.push(u),u.neighbours.push(p)}break;case 1:if(d!=0){let p=this.grid_points[n(r-1,d-1)];p.neighbours.push(u),u.neighbours.push(p)}if(d!=this.ny-2+c){let p=this.grid_points[n(r-1,d)];p.neighbours.push(u),u.neighbours.push(p)}break;case 2:if(r!=0){let p=this.grid_points[n(r-1,d)];p.neighbours.push(u),u.neighbours.push(p)}break;case 3:let y=this.grid_points[n(r-1,d+1)];y.neighbours.push(u),u.neighbours.push(y),y=this.grid_points[n(r-1,d)],y.neighbours.push(u),u.neighbours.push(y);break}this.grid_points.push(u)}}}calc_lines(){delete this.grid_lines,this.clusters,this.grid_lines=[],this.clusters=[];let i=new Set(this.grid_points),e=i.keys().next(),h=0;for(;!e.done;){let{cluster:t,index:s}=this.calc_lines_step(e.value,i,h);h=s,this.grid_lines.push(...t.lines),t.points.length>0&&this.clusters.push(t),e=i.keys().next()}}calc_lines_step(i,e,h){var r;let t=[i],s=[],l=[],n=i;if(e.delete(n),!n.occupied)return{cluster:{points:t,lines:s},index:h};for(;n!==null;){e.delete(n),n.occupied&&t.push(n);for(let a of n.neighbours)!a.occupied||e.has(a)&&(s.push(new x(n,a,h)),h++,l.push(a));n=(r=l.pop())!=null?r:null}return{cluster:{points:t,lines:s},index:h}}calc_lines_rec(i,e){if(!e.has(i))return[[],[]];e.delete(i);let h=[i],t=[];if(!i.occupied)return[h,t];for(let s of i.neighbours)s.occupied&&e.has(s)&&t.push(new x(i,s,0));for(let s of i.neighbours){if(!s.occupied)continue;let[l,n]=this.calc_lines_rec(s,e);h.push(...l),t.push(...n)}return[h,t]}draw(){let i=this.view.selectAll("g").data(this.clusters).join("g").attr("class","highlight"),e=this.nx*this.ny,h=10*(this.anim_ms/e/this.p);h=h*.01*Math.pow(e,.5),i.selectAll("line").data(t=>t.lines).join("line").attr("x1",t=>t.n1.x).attr("x2",t=>t.n1.x).attr("y1",t=>t.n1.y).attr("y2",t=>t.n1.y).attr("stroke-width",this.r/2).attr("class","build").transition().duration(h).delay(t=>this.anim_ms*2+this.anim_wait+h*t.index).attr("y2",t=>t.n2.y).attr("x2",t=>t.n2.x).transition().duration(h).delay(h*this.nx*this.ny/10).attr("class",""),i.selectAll("circle").data((t,s)=>t.points.map(l=>({point:l,color:`hsl(${s*360/t.points.length}, 90%, 31%)`}))).join("circle").transition().duration(this.anim_ms).attr("cx",t=>t.point.x).attr("cy",t=>t.point.y).attr("r",String(this.r)).attr("fill","black").attr("class",t=>t.point.occupied?"active":"").transition().delay(this.anim_wait).duration(this.anim_ms).attr("fill",t=>t.point.occupied?t.color:"transparent")}init(){this.nx=Number(this.x_slider.value),this.ny=Number(this.y_slider.value),this.calc_points(),this.calc_lines(),this.draw(),this.svg.call(this.zoom)}}class f{constructor(i,e,h){o(this,"x");o(this,"y");o(this,"occupied");o(this,"neighbours",[]);this.x=i,this.y=e,this.occupied=h}}class x{constructor(i,e,h){o(this,"n1");o(this,"n2");o(this,"index");this.n1=i,this.n2=e,this.index=h}}new E("#mySVG",1e3,100);
