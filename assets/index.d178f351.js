var _=Object.defineProperty;var y=(d,i,s)=>i in d?_(d,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[i]=s;var l=(d,i,s)=>(y(d,typeof i!="symbol"?i+"":i,s),s);import{s as u,z as f,i as x,t as m}from"./vendor.f720daf1.js";const v=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const h of e.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?e.credentials="include":t.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}};v();class b{constructor(i,s,n){l(this,"anim_ms");l(this,"anim_wait");l(this,"svg_id");l(this,"svg");l(this,"view");l(this,"zoom");l(this,"width");l(this,"height");l(this,"button",u("#percButton").node());l(this,"p_slider",u("#pSlider").node());l(this,"x_slider",u("#xSlider").node());l(this,"y_slider",u("#ySlider").node());l(this,"lattice_select",u("#lattice-select").node());l(this,"p",Number(this.p_slider.value));l(this,"nx",Number(this.x_slider.value));l(this,"ny",Number(this.y_slider.value));l(this,"r",0);l(this,"changed",!0);l(this,"grid_points",[]);l(this,"grid_lines",[]);l(this,"clusters",[]);l(this,"lattice");this.anim_ms=s,this.anim_wait=n,this.svg_id=i,this.svg=u(i),this.width=this.svg.node().clientWidth,this.height=this.svg.node().clientHeight,this.svg.attr("viewBox",String([0,0,this.width,this.height])).attr("width",this.width).attr("height",this.height),this.view=this.svg.append("g"),this.zoom=f().touchable(()=>!0).scaleExtent([.25,16]).on("zoom",t=>{const{transform:e}=t;this.view.attr("transform",e)}),this.svg.node().addEventListener("click",()=>{this.svg.transition().duration(750).call(this.zoom.transform,x,m(this.svg.node()).invert([this.width/2,this.height/2]))}),this.p_slider.previousElementSibling.innerHTML=`p=${this.p.toFixed(2)}`,this.x_slider.previousElementSibling.innerHTML=`N_x=${this.nx.toFixed(0)}`,this.y_slider.previousElementSibling.innerHTML=`N_y=${this.ny.toFixed(0)}`,this.lattice=this.lattice_select.value,this.p_slider.addEventListener("input",()=>{this.p=Number(this.p_slider.value),this.p_slider.previousElementSibling.innerHTML=`p=${this.p.toFixed(2)}`}),this.x_slider.addEventListener("input",()=>{let t=Number(this.x_slider.value);this.x_slider.previousElementSibling.innerHTML=`N_x=${t.toFixed(0)}`}),this.y_slider.addEventListener("input",()=>{let t=Number(this.y_slider.value);this.y_slider.previousElementSibling.innerHTML=`N_y=${t.toFixed(0)}`}),this.lattice_select.addEventListener("change",t=>{this.lattice=this.lattice_select.value,this.changed=!0}),this.p_slider.addEventListener("change",t=>{}),this.x_slider.addEventListener("change",()=>{this.changed=!0}),this.y_slider.addEventListener("change",()=>{this.changed=!0}),this.button.addEventListener("click",()=>{this.changed?(this.init(),this.changed=!1):(this.calc_occupation(),this.calc_lines(),this.draw())}),this.init()}recalc_r(){this.r=Math.min(this.width/this.nx,this.height/this.ny)/3}calc_occupation(){for(let i of this.grid_points)i.occupied=Math.random()<this.p}calc_points(){switch(this.lattice){case"triangular":this.triangular_lattice();break;case"square":this.square_lattice();break;case"ugly_square":this.non_square_lattice();break;default:this.triangular_lattice()}}non_square_lattice(){this.recalc_r();let i=this.r+5,s=this.r+5,n=(this.width-2*i)/(this.nx-1),t=(this.height-2*s)/(this.ny-1);delete this.grid_points,this.grid_points=[];for(let e=0;e<this.nx;e++)for(let h=0;h<this.ny;h++){let r=new p(i+n*e,s+t*h,Math.random()<this.p);if(e!=0){let o=this.grid_points[(e-1)*this.ny+h];o.neighbours.push(r),r.neighbours.push(o)}if(h!=0){let o=this.grid_points[e*this.ny+(h-1)];o.neighbours.push(r),r.neighbours.push(o)}this.grid_points.push(r)}}triangular_lattice(){this.recalc_r();let i,s,n,t;this.nx>=this.ny?(i=this.r+5,n=(this.width-2*i)/(this.nx-1),t=n,s=i+(this.height-this.width/this.nx*this.ny)/2):(s=this.r+5,t=(this.height-2*s)/(this.ny-1),n=t,i=(this.width-this.height/this.ny*this.nx)/2),delete this.grid_points,this.grid_points=[];let e=(h,r)=>h*this.ny+r-Math.floor(h/2);for(let h=0;h<this.nx;h++){let r=h%2;for(let o=0;o<this.ny-r;o++){let a=new p(i+n*h,s+t*o+r*n/2,Math.random()<this.p);if(h!=0&&o!=this.ny-1){let c=this.grid_points[e(h-1,o)];c.neighbours.push(a),a.neighbours.push(c)}if(h!=0&&o+2*r!=0){let c=this.grid_points[e(h-1,o+2*r-1)];c.neighbours.push(a),a.neighbours.push(c)}if(o!=0){let c=this.grid_points[e(h,o-1)];c.neighbours.push(a),a.neighbours.push(c)}this.grid_points.push(a)}}}square_lattice(){this.recalc_r();let i,s,n,t;this.nx>=this.ny?(i=this.r+5,n=(this.width-2*i)/(this.nx-1),t=n,s=i+(this.height-this.width/this.nx*this.ny)/2):(s=this.r+5,t=(this.height-2*s)/(this.ny-1),n=t,i=(this.width-this.height/this.ny*this.nx)/2),delete this.grid_points,this.grid_points=[];for(let e=0;e<this.nx;e++)for(let h=0;h<this.ny;h++){let r=new p(i+n*e,s+t*h,Math.random()<this.p);if(e!=0){let o=this.grid_points[(e-1)*this.ny+h];o.neighbours.push(r),r.neighbours.push(o)}if(h!=0){let o=this.grid_points[e*this.ny+(h-1)];o.neighbours.push(r),r.neighbours.push(o)}this.grid_points.push(r)}}calc_lines(){delete this.grid_lines,this.clusters,this.grid_lines=[],this.clusters=[];let i=new Set(this.grid_points),s=i.keys().next(),n=0;for(;!s.done;){let{cluster:t,index:e}=this.calc_lines_step(s.value,i,n);n=e,this.grid_lines.push(...t.lines),t.points.length>0&&this.clusters.push(t),s=i.keys().next()}}calc_lines_step(i,s,n){var o;let t=[i],e=[],h=[],r=i;if(s.delete(r),!r.occupied)return{cluster:{points:t,lines:e},index:n};for(;r!==null;){s.delete(r),r.occupied&&t.push(r);for(let a of r.neighbours)!a.occupied||s.has(a)&&(e.push(new g(r,a,n)),n++,h.push(a));r=(o=h.pop())!=null?o:null}return{cluster:{points:t,lines:e},index:n}}calc_lines_rec(i,s){if(!s.has(i))return[[],[]];s.delete(i);let n=[i],t=[];if(!i.occupied)return[n,t];for(let e of i.neighbours)e.occupied&&s.has(e)&&t.push(new g(i,e,0));for(let e of i.neighbours){if(!e.occupied)continue;let[h,r]=this.calc_lines_rec(e,s);n.push(...h),t.push(...r)}return[n,t]}draw(){this.recalc_r();let i=this.view.selectAll("g").data(this.clusters).join("g").attr("class","highlight"),s=this.nx*this.ny,n=10*(this.anim_ms/s/this.p);n=n*.01*Math.pow(s,.5),i.selectAll("line").data(t=>t.lines).join("line").attr("x1",t=>t.n1.x).attr("x2",t=>t.n1.x).attr("y1",t=>t.n1.y).attr("y2",t=>t.n1.y).attr("stroke-width",this.r/2).attr("class","build").transition().duration(n).delay(t=>this.anim_ms*2+this.anim_wait+n*t.index).attr("y2",t=>t.n2.y).attr("x2",t=>t.n2.x).transition().duration(n).delay(n*this.nx*this.ny/10).attr("class",""),i.selectAll("circle").data(t=>t.points).join("circle").transition().duration(this.anim_ms).attr("cx",t=>t.x).attr("cy",t=>t.y).attr("r",this.r).attr("fill","black").attr("class",t=>t.occupied?"active":"").transition().delay(this.anim_wait).duration(this.anim_ms).attr("fill",t=>t.occupied?"black":"transparent")}init(){this.nx=Number(this.x_slider.value),this.ny=Number(this.y_slider.value),this.calc_points(),this.calc_lines(),this.draw(),this.svg.call(this.zoom)}}class p{constructor(i,s,n){l(this,"x");l(this,"y");l(this,"occupied");l(this,"neighbours",[]);this.x=i,this.y=s,this.occupied=n}}class g{constructor(i,s,n){l(this,"n1");l(this,"n2");l(this,"index");this.n1=i,this.n2=s,this.index=n}}new b("#mySVG",1e3,100);
